<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.148.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Database Migration with Flyway :: Create a new AWS account.</title>

    
    <link href="/css/nucleus.css?1755012969" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1755012969" rel="stylesheet">
    <link href="/css/hybrid.css?1755012969" rel="stylesheet">
    <link href="/css/featherlight.min.css?1755012969" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1755012969" rel="stylesheet">
    <link href="/css/auto-complete.css?1755012969" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1755012969" rel="stylesheet">
    <link href="/css/theme.css?1755012969" rel="stylesheet">
    <link href="/css/hugo-theme.css?1755012969" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1755012969" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1755012969"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/2-rds-mysql-springboot/2.3-database-migration/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1755012969"></script>
<script type="text/javascript" src="/js/auto-complete.js?1755012969"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1755012969"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-create-new-aws-account/" title="Creating a new AWS Account" class="dd-item 
        
        
        
        ">
      <a href="/1-create-new-aws-account/">
           <b> 1. </b> Creating a new AWS Account
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/1-create-new-aws-account/1.1-find-account-id/" title="Finding Account ID" class="dd-item 
        
        
        
        ">
      <a href="/1-create-new-aws-account/1.1-find-account-id/">
           <b> 1.1 </b> Finding Account ID
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-create-new-aws-account/1.2-update-account/" title="Update Account Information" class="dd-item 
        
        
        
        ">
      <a href="/1-create-new-aws-account/1.2-update-account/">
           <b> 1.2 </b> Update Account Information
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-create-new-aws-account/1.3-aws-account-alias/" title="AWS Account Alias" class="dd-item 
        
        
        
        ">
      <a href="/1-create-new-aws-account/1.3-aws-account-alias/">
           <b> 1.3 </b> AWS Account Alias
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-create-new-aws-account/1.4-close-account/" title="Close Account" class="dd-item 
        
        
        
        ">
      <a href="/1-create-new-aws-account/1.4-close-account/">
           <b> 1.4 </b> Close Account
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-rds-mysql-springboot/" title="RDS với MySQL - Spring Boot Integration" class="dd-item 
        parent
        
        
        ">
      <a href="/2-rds-mysql-springboot/">
           <b> 2. </b> RDS với MySQL - Spring Boot Integration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-rds-mysql-springboot/2.1-rds-instance-setup/" title="RDS Instance Setup" class="dd-item 
        
        
        
        ">
      <a href="/2-rds-mysql-springboot/2.1-rds-instance-setup/">
           <b> 2.1 </b> RDS Instance Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-rds-mysql-springboot/2.2-springboot-configuration/" title="Spring Boot Database Configuration" class="dd-item 
        
        
        
        ">
      <a href="/2-rds-mysql-springboot/2.2-springboot-configuration/">
           <b> 2.2 </b> Spring Boot Database Configuration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-rds-mysql-springboot/2.3-database-migration/" title="Database Migration with Flyway" class="dd-item 
        
        active
        
        ">
      <a href="/2-rds-mysql-springboot/2.3-database-migration/">
           <b> 2.3 </b> Database Migration with Flyway
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-amazon-s3-storage/" title="Amazon S3 - File Storage &amp; Management" class="dd-item 
        
        
        
        ">
      <a href="/3-amazon-s3-storage/">
           <b> 3. </b> Amazon S3 - File Storage &amp; Management
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-amazon-s3-storage/3.1-s3-bucket-setup/" title="S3 Bucket Setup &amp; Configuration" class="dd-item 
        
        
        
        ">
      <a href="/3-amazon-s3-storage/3.1-s3-bucket-setup/">
           <b> 3.1 </b> S3 Bucket Setup &amp; Configuration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-amazon-s3-storage/3.2-springboot-integration/" title="Spring Boot S3 Integration" class="dd-item 
        
        
        
        ">
      <a href="/3-amazon-s3-storage/3.2-springboot-integration/">
           <b> 3.2 </b> Spring Boot S3 Integration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-amazon-s3-storage/3.3-cloudfront-integration/" title="CloudFront CDN Integration" class="dd-item 
        
        
        
        ">
      <a href="/3-amazon-s3-storage/3.3-cloudfront-integration/">
           <b> 3.3 </b> CloudFront CDN Integration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-mongodb-atlas/" title="MongoDB Atlas - Cloud Database Service" class="dd-item 
        
        
        
        ">
      <a href="/4-mongodb-atlas/">
           <b> 4. </b> MongoDB Atlas - Cloud Database Service
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/4-mongodb-atlas/4.1-atlas-setup/" title="MongoDB Atlas Setup &amp; Configuration" class="dd-item 
        
        
        
        ">
      <a href="/4-mongodb-atlas/4.1-atlas-setup/">
           <b> 4.1 </b> MongoDB Atlas Setup &amp; Configuration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://aws.amazon.com/blogs"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/2-rds-mysql-springboot/2.3-database-migration/" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830891&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>26-11-2023</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng</a>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Esoclusty E-Learning Platform Workshop</a> > <a href='/2-rds-mysql-springboot/'>RDS với MySQL - Spring Boot Integration</a> > Database Migration with Flyway
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Database Migration with Flyway
            </h1>
          

        



	<h1 id="database-migration-with-flyway">Database Migration with Flyway</h1>
<h4 id="overview">Overview</h4>
<p>Trong phần này, chúng ta sẽ học cách sử dụng Flyway để quản lý database migration một cách tự động và an toàn. Flyway sẽ giúp bạn version control database schema, tự động chạy migration scripts, và đảm bảo consistency giữa các môi trường development, staging, và production.</p>
<h4 id="prerequisites">Prerequisites</h4>
<h5 id="flyway-setup">Flyway Setup</h5>
<p><strong>Required Dependencies</strong></p>
<ul>
<li><strong>Flyway Core</strong>: Core migration engine</li>
<li><strong>Flyway MySQL</strong>: MySQL-specific support</li>
<li><strong>Spring Boot Flyway</strong>: Spring Boot integration</li>
</ul>
<p><strong>Maven Dependencies</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>org.flywaydb<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>flyway-core<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>org.flywaydb<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>flyway-mysql<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><hr>
<h4 id="step-1-flyway-configuration">Step 1: Flyway Configuration</h4>
<h5 id="basic-configuration">Basic Configuration</h5>
<p><strong>Application Properties</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># Flyway Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.enabled</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.baseline-on-migrate</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.baseline-version</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.baseline-description</span><span style="color:#f92672">=</span><span style="color:#e6db74">Initial baseline</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.locations</span><span style="color:#f92672">=</span><span style="color:#e6db74">classpath:db/migration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.table</span><span style="color:#f92672">=</span><span style="color:#e6db74">flyway_schema_history</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.validate-on-migrate</span><span style="color:#f92672">=</span><span style="color:#e6db74">false</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.clean-disabled</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.out-of-order</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.mixed</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span></code></pre></div>
<div class="notices info" ><p><strong>Console Screenshot</strong>: Chụp màn hình Flyway configuration trong application.properties</p>
</div>

<p><strong>Configuration Parameters Explanation</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">enabled=true</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Kích hoạt Flyway migration</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Tự động chạy khi application start</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">baseline-on-migrate=true</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Tự động tạo baseline nếu database đã có data</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Hữu ích cho existing databases</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Prevents migration errors</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">locations=classpath:db/migration</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Thư mục chứa migration scripts</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Default</span>: <span style="color:#ae81ff">src/main/resources/db/migration</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Có thể thêm multiple locations</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">table=flyway_schema_history</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Bảng lưu trữ migration history</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Tracking tất cả migrations đã chạy</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Không nên thay đổi tên bảng này</span>
</span></span></code></pre></div><hr>
<h4 id="step-2-migration-scripts-structure">Step 2: Migration Scripts Structure</h4>
<h5 id="file-naming-convention">File Naming Convention</h5>
<p><strong>Standard Naming Pattern</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Migration Script Format</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">V[version]__[description].sql</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">V1__Create_users_table.sql</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">V2__Add_email_index.sql</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">V3__Create_courses_table.sql</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">V4__Add_enrollment_relationship.sql</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Version Numbering Strategies</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Sequential</span>: <span style="color:#ae81ff">V1, V2, V3...</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Minor versions</span>: <span style="color:#ae81ff">V1.1, V1.2...</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Date-based</span>: <span style="color:#ae81ff">V20240101__Initial_schema.sql</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Semantic</span>: <span style="color:#ae81ff">V1.0.0__Initial_release.sql</span>
</span></span></code></pre></div><p><strong>File Organization</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Directory Structure</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">src/main/resources/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">└── db/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">└── migration/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">├── V1__Create_users_table.sql</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">├── V2__Add_email_index.sql</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">├── V3__Create_courses_table.sql</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">└── V4__Add_enrollment_relationship.sql</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Alternative Locations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">classpath:db/migration</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">classpath:db/migration/mysql</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">filesystem:/path/to/migrations</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">s3://bucket/migrations</span>
</span></span></code></pre></div><hr>
<h4 id="step-3-creating-migration-scripts">Step 3: Creating Migration Scripts</h4>
<h5 id="initial-schema-migration">Initial Schema Migration</h5>
<p><strong>V1__Create_users_table.sql</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Create users table
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> users (
</span></span><span style="display:flex;"><span>    id BIGINT AUTO_INCREMENT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
</span></span><span style="display:flex;"><span>    email VARCHAR(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">UNIQUE</span>,
</span></span><span style="display:flex;"><span>    password_hash VARCHAR(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    first_name VARCHAR(<span style="color:#ae81ff">100</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    last_name VARCHAR(<span style="color:#ae81ff">100</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">role</span> ENUM(<span style="color:#e6db74">&#39;ADMIN&#39;</span>, <span style="color:#e6db74">&#39;TEACHER&#39;</span>, <span style="color:#e6db74">&#39;STUDENT&#39;</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;STUDENT&#39;</span>,
</span></span><span style="display:flex;"><span>    created_at <span style="color:#66d9ef">TIMESTAMP</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>,
</span></span><span style="display:flex;"><span>    updated_at <span style="color:#66d9ef">TIMESTAMP</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>,
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> idx_users_email (email),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> idx_users_role (<span style="color:#66d9ef">role</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> idx_users_created_at (created_at)
</span></span><span style="display:flex;"><span>) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8mb4 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8mb4_unicode_ci;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Insert default admin user
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> users (email, password_hash, first_name, last_name, <span style="color:#66d9ef">role</span>) 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;admin@elearning.com&#39;</span>, <span style="color:#e6db74">&#39;$2a$12$...&#39;</span>, <span style="color:#e6db74">&#39;Admin&#39;</span>, <span style="color:#e6db74">&#39;User&#39;</span>, <span style="color:#e6db74">&#39;ADMIN&#39;</span>);
</span></span></code></pre></div><p><strong>V2__Add_email_index.sql</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Add unique constraint to email
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> users <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">CONSTRAINT</span> uk_users_email <span style="color:#66d9ef">UNIQUE</span> (email);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Add additional indexes for performance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">INDEX</span> idx_users_role_created_at <span style="color:#66d9ef">ON</span> users(<span style="color:#66d9ef">role</span>, created_at);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">INDEX</span> idx_users_first_name_last_name <span style="color:#66d9ef">ON</span> users(first_name, last_name);
</span></span></code></pre></div><p><strong>V3__Create_courses_table.sql</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Create courses table
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> courses (
</span></span><span style="display:flex;"><span>    id BIGINT AUTO_INCREMENT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
</span></span><span style="display:flex;"><span>    title VARCHAR(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    description TEXT,
</span></span><span style="display:flex;"><span>    category VARCHAR(<span style="color:#ae81ff">100</span>),
</span></span><span style="display:flex;"><span>    difficulty ENUM(<span style="color:#e6db74">&#39;BEGINNER&#39;</span>, <span style="color:#e6db74">&#39;INTERMEDIATE&#39;</span>, <span style="color:#e6db74">&#39;ADVANCED&#39;</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;BEGINNER&#39;</span>,
</span></span><span style="display:flex;"><span>    estimated_hours INT <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    price DECIMAL(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span>,
</span></span><span style="display:flex;"><span>    status ENUM(<span style="color:#e6db74">&#39;DRAFT&#39;</span>, <span style="color:#e6db74">&#39;PUBLISHED&#39;</span>, <span style="color:#e6db74">&#39;ARCHIVED&#39;</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;DRAFT&#39;</span>,
</span></span><span style="display:flex;"><span>    teacher_id BIGINT,
</span></span><span style="display:flex;"><span>    created_at <span style="color:#66d9ef">TIMESTAMP</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>,
</span></span><span style="display:flex;"><span>    updated_at <span style="color:#66d9ef">TIMESTAMP</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>,
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> (teacher_id) <span style="color:#66d9ef">REFERENCES</span> users(id) <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">SET</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> idx_courses_title (title),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> idx_courses_category (category),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> idx_courses_status (status),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> idx_courses_teacher_id (teacher_id)
</span></span><span style="display:flex;"><span>) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8mb4 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8mb4_unicode_ci;
</span></span></code></pre></div><hr>
<h4 id="step-4-advanced-migration-scripts">Step 4: Advanced Migration Scripts</h4>
<h5 id="data-migration-scripts">Data Migration Scripts</h5>
<p><strong>V4__Seed_initial_data.sql</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Insert sample courses
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> courses (title, description, category, difficulty, estimated_hours, price, status, teacher_id) <span style="color:#66d9ef">VALUES</span>
</span></span><span style="display:flex;"><span>(<span style="color:#e6db74">&#39;Introduction to Spring Boot&#39;</span>, <span style="color:#e6db74">&#39;Learn Spring Boot fundamentals&#39;</span>, <span style="color:#e6db74">&#39;PROGRAMMING&#39;</span>, <span style="color:#e6db74">&#39;BEGINNER&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">99</span>.<span style="color:#ae81ff">99</span>, <span style="color:#e6db74">&#39;PUBLISHED&#39;</span>, <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#e6db74">&#39;Advanced Java Development&#39;</span>, <span style="color:#e6db74">&#39;Master Java programming&#39;</span>, <span style="color:#e6db74">&#39;PROGRAMMING&#39;</span>, <span style="color:#e6db74">&#39;ADVANCED&#39;</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">199</span>.<span style="color:#ae81ff">99</span>, <span style="color:#e6db74">&#39;PUBLISHED&#39;</span>, <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#e6db74">&#39;Web Development Basics&#39;</span>, <span style="color:#e6db74">&#39;HTML, CSS, JavaScript fundamentals&#39;</span>, <span style="color:#e6db74">&#39;WEB_DEVELOPMENT&#39;</span>, <span style="color:#e6db74">&#39;BEGINNER&#39;</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">149</span>.<span style="color:#ae81ff">99</span>, <span style="color:#e6db74">&#39;PUBLISHED&#39;</span>, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Insert sample users
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> users (email, password_hash, first_name, last_name, <span style="color:#66d9ef">role</span>) <span style="color:#66d9ef">VALUES</span>
</span></span><span style="display:flex;"><span>(<span style="color:#e6db74">&#39;teacher1@elearning.com&#39;</span>, <span style="color:#e6db74">&#39;$2a$12$...&#39;</span>, <span style="color:#e6db74">&#39;Jane&#39;</span>, <span style="color:#e6db74">&#39;Smith&#39;</span>, <span style="color:#e6db74">&#39;TEACHER&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#e6db74">&#39;student1@elearning.com&#39;</span>, <span style="color:#e6db74">&#39;$2a$12$...&#39;</span>, <span style="color:#e6db74">&#39;John&#39;</span>, <span style="color:#e6db74">&#39;Doe&#39;</span>, <span style="color:#e6db74">&#39;STUDENT&#39;</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#e6db74">&#39;student2@elearning.com&#39;</span>, <span style="color:#e6db74">&#39;$2a$12$...&#39;</span>, <span style="color:#e6db74">&#39;Alice&#39;</span>, <span style="color:#e6db74">&#39;Johnson&#39;</span>, <span style="color:#e6db74">&#39;STUDENT&#39;</span>);
</span></span></code></pre></div><p><strong>V5__Add_enrollment_table.sql</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Create enrollments table
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> enrollments (
</span></span><span style="display:flex;"><span>    id BIGINT AUTO_INCREMENT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
</span></span><span style="display:flex;"><span>    user_id BIGINT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    course_id BIGINT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    enrolled_at <span style="color:#66d9ef">TIMESTAMP</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>,
</span></span><span style="display:flex;"><span>    progress DECIMAL(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span>,
</span></span><span style="display:flex;"><span>    status ENUM(<span style="color:#e6db74">&#39;ACTIVE&#39;</span>, <span style="color:#e6db74">&#39;COMPLETED&#39;</span>, <span style="color:#e6db74">&#39;CANCELLED&#39;</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;ACTIVE&#39;</span>,
</span></span><span style="display:flex;"><span>    completed_at <span style="color:#66d9ef">TIMESTAMP</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> (user_id) <span style="color:#66d9ef">REFERENCES</span> users(id) <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">CASCADE</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> (course_id) <span style="color:#66d9ef">REFERENCES</span> courses(id) <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">CASCADE</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> uk_user_course (user_id, course_id),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> idx_enrollments_user_id (user_id),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> idx_enrollments_course_id (course_id),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> idx_enrollments_status (status)
</span></span><span style="display:flex;"><span>) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8mb4 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8mb4_unicode_ci;
</span></span></code></pre></div><hr>
<h4 id="step-5-running-migrations">Step 5: Running Migrations</h4>
<h5 id="automatic-migration">Automatic Migration</h5>
<p><strong>Application Startup</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Migration Process</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Application starts</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Flyway checks database schema</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Compares with migration scripts</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Runs pending migrations automatically</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Updates flyway_schema_history table</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Application continues startup</span>
</span></span></code></pre></div><p><strong>Manual Migration Commands</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Check migration status</span>
</span></span><span style="display:flex;"><span>mvn flyway:info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run migrations manually</span>
</span></span><span style="display:flex;"><span>mvn flyway:migrate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Validate migrations</span>
</span></span><span style="display:flex;"><span>mvn flyway:validate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Repair migrations if needed</span>
</span></span><span style="display:flex;"><span>mvn flyway:repair
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Clean database (development only)</span>
</span></span><span style="display:flex;"><span>mvn flyway:clean
</span></span></code></pre></div><hr>
<h4 id="step-6-migration-management">Step 6: Migration Management</h4>
<h5 id="version-control-integration">Version Control Integration</h5>
<p><strong>Git Workflow</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Development Process</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">1</span><span style="color:#ae81ff">. Create feature branch</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">2</span><span style="color:#ae81ff">. Write migration script</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">3</span><span style="color:#ae81ff">. Test migration locally</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">4</span><span style="color:#ae81ff">. Commit migration script</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">5</span><span style="color:#ae81ff">. Push to remote branch</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">6</span><span style="color:#ae81ff">. Create pull request</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">7</span><span style="color:#ae81ff">. Code review</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">8</span><span style="color:#ae81ff">. Merge to main branch</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">9</span><span style="color:#ae81ff">. Deploy to production</span>
</span></span></code></pre></div><p><strong>Migration Script Review</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Review Checklist</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Naming convention follows standard</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">SQL syntax is correct</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Indexes are appropriate</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Foreign keys are properly defined</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Data types are suitable</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Default values are reasonable</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Rollback strategy is considered</span>
</span></span></code></pre></div><hr>
<h4 id="step-7-rollback-strategies">Step 7: Rollback Strategies</h4>
<h5 id="rollback-approaches">Rollback Approaches</h5>
<p><strong>Version-based Rollback</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Create rollback script V5.1__Rollback_enrollment_table.sql
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> enrollments;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Or create V6__Remove_enrollment_table.sql
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> enrollments;
</span></span></code></pre></div><p><strong>Data Preservation</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Before dropping table, backup data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> enrollments_backup <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> enrollments;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Or export to file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> enrollments <span style="color:#66d9ef">INTO</span> OUTFILE <span style="color:#e6db74">&#39;/tmp/enrollments_backup.csv&#39;</span>
</span></span><span style="display:flex;"><span>FIELDS TERMINATED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;,&#39;</span> ENCLOSED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;&#34;&#39;</span>
</span></span><span style="display:flex;"><span>LINES TERMINATED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;\n&#39;</span>;
</span></span></code></pre></div><hr>
<h4 id="step-8-testing-migrations">Step 8: Testing Migrations</h4>
<h5 id="test-environment-setup">Test Environment Setup</h5>
<p><strong>Test Database Configuration</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># application-test.properties</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.datasource.url</span><span style="color:#f92672">=</span><span style="color:#e6db74">jdbc:h2:mem:testdb</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.datasource.driver-class-name</span><span style="color:#f92672">=</span><span style="color:#e6db74">org.h2.Driver</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.enabled</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.flyway.locations</span><span style="color:#f92672">=</span><span style="color:#e6db74">classpath:db/migration</span>
</span></span></code></pre></div><p><strong>Migration Testing</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@SpringBootTest</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@ActiveProfiles</span>(<span style="color:#e6db74">&#34;test&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FlywayMigrationTest</span> {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> JdbcTemplate jdbcTemplate;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">shouldCreateUsersTable</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Given</span>
</span></span><span style="display:flex;"><span>        String sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT COUNT(*) FROM information_schema.tables WHERE table_name = &#39;users&#39;&#34;</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// When</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> jdbcTemplate.<span style="color:#a6e22e">queryForObject</span>(sql, Integer.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Then</span>
</span></span><span style="display:flex;"><span>        assertThat(count).<span style="color:#a6e22e">isEqualTo</span>(1);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">shouldHaveCorrectUserColumns</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Given</span>
</span></span><span style="display:flex;"><span>        String sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT column_name FROM information_schema.columns WHERE table_name = &#39;users&#39; ORDER BY ordinal_position&#34;</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// When</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> columns <span style="color:#f92672">=</span> jdbcTemplate.<span style="color:#a6e22e">queryForList</span>(sql, String.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Then</span>
</span></span><span style="display:flex;"><span>        assertThat(columns).<span style="color:#a6e22e">contains</span>(<span style="color:#e6db74">&#34;id&#34;</span>, <span style="color:#e6db74">&#34;email&#34;</span>, <span style="color:#e6db74">&#34;password_hash&#34;</span>, <span style="color:#e6db74">&#34;first_name&#34;</span>, <span style="color:#e6db74">&#34;last_name&#34;</span>, <span style="color:#e6db74">&#34;role&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h4 id="step-9-production-deployment">Step 9: Production Deployment</h4>
<h5 id="production-considerations">Production Considerations</h5>
<p><strong>Migration Safety</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Production Guidelines</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Always backup database before migration</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Test migrations on staging environment</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Use maintenance window for major changes</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Monitor migration execution</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Have rollback plan ready</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Document all changes</span>
</span></span></code></pre></div><p><strong>Deployment Process</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Production deployment steps</span>
</span></span><span style="display:flex;"><span>1. Backup production database
</span></span><span style="display:flex;"><span>2. Deploy application with new migrations
</span></span><span style="display:flex;"><span>3. Monitor migration execution
</span></span><span style="display:flex;"><span>4. Verify database schema
</span></span><span style="display:flex;"><span>5. Run smoke tests
</span></span><span style="display:flex;"><span>6. Monitor application health
</span></span><span style="display:flex;"><span>7. Rollback <span style="color:#66d9ef">if</span> issues occur
</span></span></code></pre></div><hr>
<h4 id="step-10-monitoring-and-maintenance">Step 10: Monitoring and Maintenance</h4>
<h5 id="migration-history">Migration History</h5>
<p><strong>Schema History Table</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Check migration history
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> flyway_schema_history <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> installed_rank <span style="color:#66d9ef">DESC</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Check current schema version
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">version</span> <span style="color:#66d9ef">FROM</span> flyway_schema_history 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> installed_rank <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MAX</span>(installed_rank) <span style="color:#66d9ef">FROM</span> flyway_schema_history);
</span></span></code></pre></div><p><strong>Performance Monitoring</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Monitoring Metrics</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Migration execution time</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Number of pending migrations</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Migration success rate</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Database schema changes</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Rollback frequency</span>
</span></span></code></pre></div><hr>
<h4 id="troubleshooting">Troubleshooting</h4>
<h5 id="common-issues">Common Issues</h5>
<p><strong>Migration Failures</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Check migration status</span>
</span></span><span style="display:flex;"><span>mvn flyway:info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># View detailed error logs</span>
</span></span><span style="display:flex;"><span>tail -f application.log | grep -i flyway
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Repair corrupted migrations</span>
</span></span><span style="display:flex;"><span>mvn flyway:repair
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check database connectivity</span>
</span></span><span style="display:flex;"><span>mysql -h <span style="color:#f92672">[</span>RDS_ENDPOINT<span style="color:#f92672">]</span> -u <span style="color:#f92672">[</span>USERNAME<span style="color:#f92672">]</span> -p
</span></span></code></pre></div><p><strong>Version Conflicts</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Common Issues</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Duplicate version numbers</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Missing migration scripts</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Database schema mismatch</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Permission issues</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Network connectivity problems</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Solutions</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Check migration script naming</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Verify database permissions</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Test connectivity</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Review error logs</span>
</span></span></code></pre></div><hr>
<h4 id="next-steps">Next Steps</h4>
<p>Với Flyway migration đã được thiết lập, chúng ta có thể:</p>
<ul>
<li>Tạo và quản lý complex migration scripts</li>
<li>Implement automated deployment pipeline</li>
<li>Monitor migration performance</li>
<li>Handle production rollbacks</li>
</ul>
<h4 id="key-takeaways">Key Takeaways</h4>
<ul>
<li><strong>Flyway migration</strong> cung cấp automated database schema management</li>
<li><strong>Version control</strong> cho database changes đảm bảo consistency</li>
<li><strong>Rollback strategies</strong> cần thiết cho production safety</li>
<li><strong>Testing migrations</strong> đảm bảo reliability</li>
<li><strong>Production deployment</strong> cần careful planning và monitoring</li>
<li><strong>Migration history</strong> cung cấp audit trail cho database changes</li>
</ul>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/2-rds-mysql-springboot/2.2-springboot-configuration/" title="Spring Boot Database Configuration"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/3-amazon-s3-storage/" title="Amazon S3 - File Storage &amp; Management" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1755012969"></script>
    <script src="/js/perfect-scrollbar.min.js?1755012969"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1755012969"></script>
    <script src="/js/jquery.sticky.js?1755012969"></script>
    <script src="/js/featherlight.min.js?1755012969"></script>
    <script src="/js/highlight.pack.js?1755012969"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1755012969"></script>
    <script src="/js/learn.js?1755012969"></script>
    <script src="/js/hugo-learn.js?1755012969"></script>

    <link href="/mermaid/mermaid.css?1755012969" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1755012969"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
